<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.3-alpha.1/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.17.3-alpha.1/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.3-alpha.1/dist/index.js"></script><script>(()=>{setTimeout(()=>{const{markmap:q,mm:N}=window,j=new q.Toolbar;j.attach(N);const we=j.render();we.setAttribute("style","position:absolute;bottom:20px;right:20px"),document.body.append(we)})})()</script><script>((u,d,h,f)=>{const g=u();window.mm=g.Markmap.create("svg#mindmap",(d||g.deriveOptions)(f),h)})(()=>window.markmap,null,{"content":"Backend - Plataforma de Venta de Números","children":[{"content":"1. <strong>Arquitectura General</strong>","children":[{"content":"<strong>Framework Backend</strong>: Node.js con Express.","children":[],"payload":{"lines":"3,4"}},{"content":"<strong>Base de Datos</strong>: PostgreSQL (Relacional).","children":[],"payload":{"lines":"4,5"}},{"content":"<strong>ORM</strong>: Sequelize para manejar las relaciones y consultas.","children":[],"payload":{"lines":"5,6"}},{"content":"<strong>Lenguaje</strong>: TypeScript para tipado estático.","children":[],"payload":{"lines":"6,7"}},{"content":"<strong>Autenticación</strong>: JWT para sesiones seguras.","children":[],"payload":{"lines":"7,8"}},{"content":"<strong>Estructura de Archivos</strong>:","children":[{"content":"<strong>src/</strong>","children":[{"content":"<code>app.ts</code>: Punto de entrada principal.","children":[],"payload":{"lines":"10,11"}},{"content":"<code>routes/</code>: Definición de rutas REST.","children":[],"payload":{"lines":"11,12"}},{"content":"<code>controllers/</code>: Lógica de negocio por módulo.","children":[],"payload":{"lines":"12,13"}},{"content":"<code>models/</code>: Definición de tablas y relaciones SQL.","children":[],"payload":{"lines":"13,14"}},{"content":"<code>services/</code>: Servicios para lógica más compleja (validaciones, reglas).","children":[],"payload":{"lines":"14,15"}},{"content":"<code>middleware/</code>: Autenticación, validaciones de solicitudes.","children":[],"payload":{"lines":"15,16"}},{"content":"<code>config/</code>: Configuración de base de datos y variables de entorno.","children":[],"payload":{"lines":"16,18"}}],"payload":{"lines":"9,18"}}],"payload":{"lines":"8,18"}}],"payload":{"lines":"2,3"}},{"content":"2. <strong>Entidades Principales</strong>","children":[{"content":"<strong>2.1 Loterías</strong>","children":[{"content":"Tabla: <code>loterias</code>","children":[{"content":"<code>id_loteria</code>: Identificador único.","children":[],"payload":{"lines":"21,22"}},{"content":"<code>nombre</code>: Nombre de la lotería (e.g., Costa Rica).","children":[],"payload":{"lines":"22,24"}}],"payload":{"lines":"20,24"}}],"payload":{"lines":"19,20"}},{"content":"<strong>2.2 Sorteos</strong>","children":[{"content":"Tabla: <code>sorteos</code>","children":[{"content":"<code>id_sorteo</code>: Identificador único.","children":[],"payload":{"lines":"26,27"}},{"content":"<code>id_loteria</code>: Relación con loterías.","children":[],"payload":{"lines":"27,28"}},{"content":"<code>hora</code>: Hora del sorteo.","children":[],"payload":{"lines":"28,30"}}],"payload":{"lines":"25,30"}}],"payload":{"lines":"24,25"}},{"content":"<strong>2.3 Ventas</strong>","children":[{"content":"Tabla: <code>ventas</code>","children":[{"content":"<code>id_venta</code>: Identificador único.","children":[],"payload":{"lines":"32,33"}},{"content":"<code>id_vendedor</code>: Relación con vendedores.","children":[],"payload":{"lines":"33,34"}},{"content":"<code>id_loteria</code>: Relación con loterías.","children":[],"payload":{"lines":"34,35"}},{"content":"<code>id_sorteo</code>: Relación con sorteos.","children":[],"payload":{"lines":"35,36"}},{"content":"<code>fecha</code>: Fecha y hora de la venta.","children":[],"payload":{"lines":"36,37"}},{"content":"<code>total_apuesta</code>: Total de la venta.","children":[],"payload":{"lines":"37,39"}}],"payload":{"lines":"31,39"}}],"payload":{"lines":"30,31"}},{"content":"<strong>2.4 Detalles de Venta</strong>","children":[{"content":"Tabla: <code>detalles_venta</code>","children":[{"content":"<code>id_detalle</code>: Identificador único.","children":[],"payload":{"lines":"41,42"}},{"content":"<code>id_venta</code>: Relación con ventas.","children":[],"payload":{"lines":"42,43"}},{"content":"<code>numero</code>: Número apostado.","children":[],"payload":{"lines":"43,44"}},{"content":"<code>monto_apuesta</code>: Monto apostado al número.","children":[],"payload":{"lines":"44,45"}},{"content":"<code>monto_reventado</code>: Monto apostado al \"Reventado\".","children":[],"payload":{"lines":"45,47"}}],"payload":{"lines":"40,47"}}],"payload":{"lines":"39,40"}},{"content":"<strong>2.5 Vendedores</strong>","children":[{"content":"Tabla: <code>vendedores</code>","children":[{"content":"<code>id_vendedor</code>: Identificador único.","children":[],"payload":{"lines":"49,50"}},{"content":"<code>id_listero</code>: Relación con <code>listeros</code>.","children":[],"payload":{"lines":"50,51"}},{"content":"<code>nombre</code>: Nombre del vendedor.","children":[],"payload":{"lines":"51,53"}}],"payload":{"lines":"48,53"}}],"payload":{"lines":"47,48"}},{"content":"<strong>2.6 Listeros</strong>","children":[{"content":"<pre data-lines=\"54,58\"><code>  - Tabla: `listeros`\n    - `id_listero`: Identificador único.\n    - `nombre`: Nombre del listero.\n    - `porcentaje`: Porcentaje asignado al listero.\n</code></pre>","children":[],"payload":{"lines":"54,58"}}],"payload":{"lines":"53,54"}},{"content":"Relaciones SQL","children":[{"content":"<pre data-lines=\"60,63\"><code>  - `listeros` → `vendedores` (1:N).\n  - `ventas` → `vendedores` (N:1).\n  - `banca` → `listeros` (Lógica de gestión o tabla adicional si se requiere).\n</code></pre>","children":[],"payload":{"lines":"60,63"}}],"payload":{"lines":"59,60"}},{"content":"<strong>2.7 Restricciones</strong>","children":[{"content":"Tabla: <code>restricciones</code>","children":[{"content":"<code>id_restriccion</code>: Identificador único.","children":[],"payload":{"lines":"66,67"}},{"content":"<code>id_loteria</code>: Relación con loterías.","children":[],"payload":{"lines":"67,68"}},{"content":"<code>id_sorteo</code>: Relación con sorteos.","children":[],"payload":{"lines":"68,69"}},{"content":"<code>numero</code>: Número restringido (opcional).","children":[],"payload":{"lines":"69,70"}},{"content":"<code>monto_maximo</code>: Monto máximo permitido.","children":[],"payload":{"lines":"70,71"}},{"content":"<code>tipo_restriccion</code>: Tipo (e.g., monto fijo o porcentaje).","children":[],"payload":{"lines":"71,73"}}],"payload":{"lines":"65,73"}}],"payload":{"lines":"64,65"}}],"payload":{"lines":"18,19"}},{"content":"3. <strong>Relaciones SQL</strong>","children":[{"content":"<code>loterias</code> → <code>sorteos</code> (1:N).","children":[],"payload":{"lines":"74,75"}},{"content":"<code>ventas</code> → <code>detalles_venta</code> (1:N).","children":[],"payload":{"lines":"75,76"}},{"content":"<code>listeros</code> → <code>vendedores</code> (1:N).","children":[],"payload":{"lines":"76,77"}},{"content":"<code>ventas</code> → <code>vendedores</code> (N:1).","children":[],"payload":{"lines":"77,78"}},{"content":"<code>restricciones</code> → <code>loterias</code> y <code>sorteos</code> (N:1).","children":[],"payload":{"lines":"78,80"}}],"payload":{"lines":"73,74"}},{"content":"4. <strong>Endpoints del API</strong>","children":[{"content":"<strong>4.1 Loterías</strong>","children":[{"content":"<code>GET /loterias</code>: Obtener lista de loterías.","children":[],"payload":{"lines":"82,83"}},{"content":"<code>POST /loterias</code>: Crear una nueva lotería.","children":[],"payload":{"lines":"83,85"}}],"payload":{"lines":"81,82"}},{"content":"<strong>4.2 Sorteos</strong>","children":[{"content":"<code>GET /sorteos</code>: Obtener lista de sorteos.","children":[],"payload":{"lines":"86,87"}},{"content":"<code>POST /sorteos</code>: Crear un nuevo sorteo.","children":[],"payload":{"lines":"87,89"}}],"payload":{"lines":"85,86"}},{"content":"<strong>4.3 Ventas</strong>","children":[{"content":"<code>POST /ventas</code>: Crear una nueva venta.","children":[],"payload":{"lines":"90,91"}},{"content":"<code>GET /ventas/:id</code>: Obtener detalles de una venta específica.","children":[],"payload":{"lines":"91,93"}}],"payload":{"lines":"89,90"}},{"content":"<strong>4.4 Restricciones</strong>","children":[{"content":"<code>POST /restricciones</code>: Crear restricciones de apuesta.","children":[],"payload":{"lines":"94,95"}},{"content":"<code>GET /restricciones</code>: Obtener restricciones aplicables.","children":[],"payload":{"lines":"95,97"}}],"payload":{"lines":"93,94"}}],"payload":{"lines":"80,81"}},{"content":"5. <strong>Casos de Uso Clave</strong>","children":[{"content":"<strong>5.1 Gestión de Ventas</strong>","children":[{"content":"Al crear una venta:","children":[{"content":"1. Registrar la venta en <code>ventas</code>.","children":[],"payload":{"lines":"100,101","listIndex":1}},{"content":"2. Registrar cada número en <code>detalles_venta</code>.","children":[],"payload":{"lines":"101,102","listIndex":2}}],"payload":{"lines":"99,102"}},{"content":"Calcular el total automáticamente.","children":[],"payload":{"lines":"102,103"}},{"content":"Validar restricciones (e.g., números bloqueados o montos máximos).","children":[],"payload":{"lines":"103,105"}}],"payload":{"lines":"98,99"}},{"content":"<strong>5.2 Reportes en Tiempo Real</strong>","children":[{"content":"Resumen por listero:","children":[{"content":"Total apostado.","children":[],"payload":{"lines":"107,108"}},{"content":"Posibles premios por pagar.","children":[],"payload":{"lines":"108,109"}}],"payload":{"lines":"106,109"}},{"content":"Ventas por sorteo o lotería:","children":[{"content":"Apuestas totales por número.","children":[],"payload":{"lines":"110,111"}},{"content":"Monto recaudado.","children":[],"payload":{"lines":"111,113"}}],"payload":{"lines":"109,113"}}],"payload":{"lines":"105,106"}}],"payload":{"lines":"97,98"}},{"content":"6. <strong>Validaciones Críticas</strong>","children":[{"content":"Antes de registrar una venta:","children":[{"content":"Validar que el sorteo no esté bloqueado (5 minutos antes).","children":[],"payload":{"lines":"115,116"}},{"content":"Validar restricciones de números o montos.","children":[],"payload":{"lines":"116,117"}},{"content":"Verificar que el vendedor tenga autorización.","children":[],"payload":{"lines":"117,119"}}],"payload":{"lines":"114,119"}}],"payload":{"lines":"113,114"}},{"content":"7. <strong>Tecnologías Asociadas</strong>","children":[{"content":"<strong>Express</strong>: Framework para APIs REST.","children":[],"payload":{"lines":"120,121"}},{"content":"<strong>Sequelize</strong>: ORM para PostgreSQL.","children":[],"payload":{"lines":"121,122"}},{"content":"<strong>JWT</strong>: Autenticación basada en tokens.","children":[],"payload":{"lines":"122,123"}},{"content":"<strong>dotenv</strong>: Manejo de variables de entorno.","children":[],"payload":{"lines":"123,124"}},{"content":"<strong>Class-Validator</strong>: Validaciones en TypeScript.","children":[],"payload":{"lines":"124,126"}}],"payload":{"lines":"119,120"}},{"content":"8. <strong>Consideraciones Futuras</strong>","children":[{"content":"Integración de notificaciones (e.g., bloqueo de sorteos en tiempo real).","children":[],"payload":{"lines":"127,128"}},{"content":"Escalabilidad para múltiples loterías simultáneamente.","children":[],"payload":{"lines":"128,129"}},{"content":"Generación automática de tiquetes en PDF.","children":[],"payload":{"lines":"129,130"}}],"payload":{"lines":"126,127"}}],"payload":{"lines":"0,1"}},null)</script>
</body>
</html>
