<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.3-alpha.1/dist/style.css">
</head>  
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.17.3-alpha.1/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.3-alpha.1/dist/index.js"></script><script>(()=>{setTimeout(()=>{const{markmap:q,mm:v}=window,j=new q.Toolbar;j.attach(v);const we=j.render();we.setAttribute("style","position:absolute;bottom:20px;right:20px"),document.body.append(we)})})()</script><script>((f,d,h,u)=>{const g=f();window.mm=g.Markmap.create("svg#mindmap",(d||g.deriveOptions)(u),h)})(()=>window.markmap,null,{"content":"Autenticación con JWT","children":[{"content":"1. Inicio del Proceso de Autenticación","children":[{"content":"Usuario ingresa credenciales (por ejemplo, email y contraseña) en el cliente (web o móvil).","children":[],"payload":{"lines":"3,4"}},{"content":"<strong>Ejemplo</strong>:<pre><code class=\"language-javascript\"><span class=\"hljs-keyword\">const</span> credentials = { <span class=\"hljs-attr\">email</span>: <span class=\"hljs-string\">\"user@example.com\"</span>, <span class=\"hljs-attr\">password</span>: <span class=\"hljs-string\">\"password123\"</span> };\naxios.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">\"/api/login\"</span>, credentials);\n</code></pre>","children":[],"payload":{"lines":"4,10"}}],"payload":{"lines":"2,3"}},{"content":"2. Verificación de Credenciales y Generación del Token","children":[{"content":"<strong>Paso 1: Validación de Credenciales</strong>","children":[{"content":"Backend verifica las credenciales en la base de datos.","children":[],"payload":{"lines":"12,13"}}],"payload":{"lines":"11,13"}},{"content":"<strong>Paso 2: Generación del Token JWT</strong>","children":[{"content":"Si son válidas, genera un <strong>JWT</strong> que contiene información del usuario (por ejemplo, su ID).","children":[],"payload":{"lines":"14,15"}},{"content":"<strong>Ejemplo</strong>:<pre><code class=\"language-javascript\"><span class=\"hljs-keyword\">const</span> jwt = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"jsonwebtoken\"</span>);\n<span class=\"hljs-keyword\">const</span> token = jwt.<span class=\"hljs-title function_\">sign</span>({ <span class=\"hljs-attr\">userId</span>: user.<span class=\"hljs-property\">id</span> }, <span class=\"hljs-string\">\"secretKey\"</span>, { <span class=\"hljs-attr\">expiresIn</span>: <span class=\"hljs-string\">\"15m\"</span> });\n</code></pre>","children":[],"payload":{"lines":"15,21"}}],"payload":{"lines":"13,21"}}],"payload":{"lines":"10,11"}},{"content":"3. Respuesta con el Token JWT","children":[{"content":"El backend envía el JWT al cliente.","children":[],"payload":{"lines":"22,23"}},{"content":"El cliente almacena el token de forma segura (e.g., <code>localStorage</code> o una cookie segura).","children":[],"payload":{"lines":"23,24"}},{"content":"<strong>Ejemplo</strong>:<pre><code class=\"language-javascript\"><span class=\"hljs-variable language_\">localStorage</span>.<span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-string\">\"token\"</span>, token);  <span class=\"hljs-comment\">// almacenamiento en el cliente</span>\n</code></pre>","children":[],"payload":{"lines":"24,29"}}],"payload":{"lines":"21,22"}},{"content":"4. Autenticación en Cada Solicitud con el Token","children":[{"content":"Middleware de Verificación","children":[{"content":"<strong>Firma y Decodificación</strong>:","children":[{"content":"Verifica la firma con la clave secreta y decodifica para obtener el payload.","children":[],"payload":{"lines":"39,40"}}],"payload":{"lines":"38,40"}},{"content":"<strong>Ejemplo de Middleware</strong>:<pre><code class=\"language-javascript\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">authMiddleware</span> = (<span class=\"hljs-params\">req, res, next</span>) =&gt; {\n  <span class=\"hljs-keyword\">const</span> token = req.<span class=\"hljs-property\">headers</span>.<span class=\"hljs-property\">authorization</span>.<span class=\"hljs-title function_\">split</span>(<span class=\"hljs-string\">\" \"</span>)[<span class=\"hljs-number\">1</span>];\n  jwt.<span class=\"hljs-title function_\">verify</span>(token, <span class=\"hljs-string\">\"secretKey\"</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">err, decoded</span>) =&gt;</span> {\n    <span class=\"hljs-keyword\">if</span> (err) <span class=\"hljs-keyword\">return</span> res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">401</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">error</span>: <span class=\"hljs-string\">\"Unauthorized\"</span> });\n    req.<span class=\"hljs-property\">user</span> = decoded;\n    <span class=\"hljs-title function_\">next</span>();\n  });\n};\n</code></pre>","children":[],"payload":{"lines":"40,52"}}],"payload":{"lines":"37,38"}}],"payload":{"lines":"29,30"}},{"content":"5. Acceso a Rutas Protegidas","children":[{"content":"Middleware permite acceso si el token es válido.","children":[],"payload":{"lines":"53,54"}},{"content":"Si es inválido o ha expirado, responde con un error.","children":[],"payload":{"lines":"54,55"}},{"content":"<strong>Ejemplo</strong>:<pre><code class=\"language-javascript\">app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">\"/api/protected\"</span>, authMiddleware, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> {\n  res.<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">\"Access granted\"</span>, <span class=\"hljs-attr\">userId</span>: req.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">userId</span> });\n});\n</code></pre>","children":[],"payload":{"lines":"55,62"}}],"payload":{"lines":"52,53"}},{"content":"6. Expiración del Token y Refresco de Token (Opcional)","children":[{"content":"<strong>Expiración</strong>: Tokens de acceso suelen durar 15 minutos.","children":[],"payload":{"lines":"63,64"}},{"content":"<strong>Token de Refresco</strong>: Permite obtener un nuevo token sin volver a autenticarse.","children":[],"payload":{"lines":"64,65"}},{"content":"<strong>Ejemplo de Refresco</strong>:<pre><code class=\"language-javascript\"><span class=\"hljs-keyword\">const</span> refreshToken = jwt.<span class=\"hljs-title function_\">sign</span>({ <span class=\"hljs-attr\">userId</span>: user.<span class=\"hljs-property\">id</span> }, <span class=\"hljs-string\">\"refreshSecret\"</span>, { <span class=\"hljs-attr\">expiresIn</span>: <span class=\"hljs-string\">\"7d\"</span> });\n</code></pre>","children":[],"payload":{"lines":"65,70"}}],"payload":{"lines":"62,63"}},{"content":"7. Cierre de Sesión (Opcional)","children":[{"content":"Implementación con <strong>lista negra</strong> de tokens revocados.","children":[],"payload":{"lines":"71,72"}},{"content":"<strong>Ejemplo de Lista Negra</strong>:<pre><code class=\"language-javascript\"><span class=\"hljs-keyword\">const</span> revokedTokens = [];\nrevokedTokens.<span class=\"hljs-title function_\">push</span>(token); <span class=\"hljs-comment\">// almacenar el token en una lista negra</span>\n</code></pre>","children":[],"payload":{"lines":"72,78"}}],"payload":{"lines":"70,71"}},{"content":"Resumen del Flujo","children":[{"content":"1. <strong>Inicio de Sesión</strong>: El usuario envía credenciales → El servidor valida y genera JWT → El cliente almacena el token.","children":[],"payload":{"lines":"79,80","listIndex":1}},{"content":"2. <strong>Acceso a Rutas Protegidas</strong>: Cliente envía el token en cada solicitud → Servidor valida → Si es válido, permite el acceso.","children":[],"payload":{"lines":"80,81","listIndex":2}},{"content":"3. <strong>Refresco de Token</strong> (opcional): Cliente usa el token de refresco para obtener un nuevo token de acceso.","children":[],"payload":{"lines":"81,82","listIndex":3}},{"content":"4. <strong>Cierre de Sesión</strong> (opcional): El token se revoca para prevenir accesos futuros.","children":[],"payload":{"lines":"82,83","listIndex":4}}],"payload":{"lines":"78,79"}}],"payload":{"lines":"0,1"}},null)</script>
</body>
</html>
