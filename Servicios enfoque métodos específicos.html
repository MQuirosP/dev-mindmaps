<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.3-alpha.1/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.17.3-alpha.1/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.3-alpha.1/dist/index.js"></script><script>(()=>{setTimeout(()=>{const{markmap:q,mm:v}=window,j=new q.Toolbar;j.attach(v);const we=j.render();we.setAttribute("style","position:absolute;bottom:20px;right:20px"),document.body.append(we)})})()</script><script>((f,d,h,u)=>{const g=f();window.mm=g.Markmap.create("svg#mindmap",(d||g.deriveOptions)(u),h)})(()=>window.markmap,null,{"content":"CustomerService - Estructura Original","children":[{"content":"Métodos del Servicio","children":[{"content":"<strong><code>createCustomer</code></strong>","children":[{"content":"Crear un nuevo cliente en la base de datos","children":[],"payload":{"lines":"3,4"}},{"content":"Manejo de errores con <code>try-catch</code>","children":[],"payload":{"lines":"4,5"}},{"content":"Usa <code>this.customerRepository.create</code> y <code>this.customerRepository.save</code>","children":[],"payload":{"lines":"5,6"}}],"payload":{"lines":"2,6"}},{"content":"<strong><code>fetchAllCustomers</code></strong>","children":[{"content":"Obtener todos los clientes registrados","children":[],"payload":{"lines":"7,8"}},{"content":"Manejo de errores con <code>try-catch</code>","children":[],"payload":{"lines":"8,9"}},{"content":"Usa <code>this.customerRepository.find</code>","children":[],"payload":{"lines":"9,10"}}],"payload":{"lines":"6,10"}},{"content":"<strong><code>getCustomerByPK</code></strong>","children":[{"content":"Buscar cliente por ID primario","children":[],"payload":{"lines":"11,12"}},{"content":"Lanza error personalizado si el cliente no existe","children":[],"payload":{"lines":"12,13"}},{"content":"Manejo de errores con <code>try-catch</code>","children":[],"payload":{"lines":"13,14"}}],"payload":{"lines":"10,14"}},{"content":"<strong><code>getCustomerByName</code></strong>","children":[{"content":"Buscar clientes por nombre usando <code>ILike</code> para coincidencias parciales","children":[],"payload":{"lines":"15,16"}},{"content":"Retorna una lista vacía si no hay coincidencias","children":[],"payload":{"lines":"16,17"}},{"content":"Manejo de errores con <code>try-catch</code>","children":[],"payload":{"lines":"17,18"}}],"payload":{"lines":"14,18"}},{"content":"<strong><code>updateCustomer</code></strong>","children":[{"content":"Actualizar los datos de un cliente existente","children":[],"payload":{"lines":"19,20"}},{"content":"Lanza error si el cliente no existe","children":[],"payload":{"lines":"20,21"}},{"content":"Usa <code>Object.assign</code> para aplicar las actualizaciones","children":[],"payload":{"lines":"21,22"}},{"content":"Manejo de errores con <code>try-catch</code>","children":[],"payload":{"lines":"22,23"}}],"payload":{"lines":"18,23"}},{"content":"<strong><code>deleteCustomer</code></strong>","children":[{"content":"Eliminar un cliente de la base de datos por su ID","children":[],"payload":{"lines":"24,25"}},{"content":"Lanza error si el cliente no existe","children":[],"payload":{"lines":"25,26"}},{"content":"Manejo de errores con <code>try-catch</code>","children":[],"payload":{"lines":"26,28"}}],"payload":{"lines":"23,28"}}],"payload":{"lines":"1,2"}},{"content":"Problemas Detectados","children":[{"content":"<strong>Repetición de Código</strong>","children":[{"content":"Bloques <code>try-catch</code> en todos los métodos para manejo de errores","children":[],"payload":{"lines":"30,31"}},{"content":"Lógica repetitiva para buscar clientes por ID en múltiples métodos","children":[],"payload":{"lines":"31,32"}}],"payload":{"lines":"29,32"}},{"content":"<strong>Falta de Modularización</strong>","children":[{"content":"Métodos contienen múltiples responsabilidades (ej. manejo de errores y operaciones de base de datos)","children":[],"payload":{"lines":"33,34"}}],"payload":{"lines":"32,34"}},{"content":"<strong>Oportunidad de Abstracción</strong>","children":[{"content":"La lógica repetida puede abstraerse para simplificar el código","children":[],"payload":{"lines":"35,37"}}],"payload":{"lines":"34,37"}}],"payload":{"lines":"28,29"}},{"content":"Principios de diseño","children":[{"content":"<strong>Uso del patrón de Error Handling</strong>","children":[{"content":"<code>try-catch</code> para manejar errores y lanzar errores personalizados","children":[],"payload":{"lines":"39,40"}}],"payload":{"lines":"38,40"}},{"content":"<strong>Estructura directa</strong>","children":[{"content":"Métodos bien definidos con propósitos específicos","children":[],"payload":{"lines":"41,42"}},{"content":"Código fácil de entender, pero repetitivo","children":[],"payload":{"lines":"42,44"}}],"payload":{"lines":"40,44"}}],"payload":{"lines":"37,38"}},{"content":"Areas para mejorar","children":[{"content":"<strong>Modularización</strong>","children":[{"content":"Crear funciones auxiliares para manejo de errores y búsqueda de clientes","children":[],"payload":{"lines":"46,47"}}],"payload":{"lines":"45,47"}},{"content":"<strong>Mejora del mantenimiento</strong>","children":[{"content":"Hacer el código más limpio y más fácil de extender en el futuro","children":[],"payload":{"lines":"48,50"}}],"payload":{"lines":"47,50"}}],"payload":{"lines":"44,45"}},{"content":"Ejemplos de Código Original","children":[{"content":"<pre><code class=\"language-typescript\">  <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">createCustomer</span>(<span class=\"hljs-attr\">customerData</span>: <span class=\"hljs-title class_\">Partial</span>&lt;<span class=\"hljs-title class_\">Customer</span>&gt;): <span class=\"hljs-title class_\">Promise</span>&lt;<span class=\"hljs-title class_\">Customer</span>&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n      <span class=\"hljs-keyword\">const</span> newCustomer = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">customerRepository</span>.<span class=\"hljs-title function_\">create</span>(customerData);\n      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">await</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">customerRepository</span>.<span class=\"hljs-title function_\">save</span>(newCustomer);\n    } <span class=\"hljs-keyword\">catch</span> (error) {\n      <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-title function_\">handleDatabaseError</span>(error);\n    }\n  }\n  <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">fetchAllCustomers</span>(): <span class=\"hljs-title class_\">Promise</span>&lt;<span class=\"hljs-title class_\">Customer</span>[]&gt; {\n  <span class=\"hljs-keyword\">try</span> {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">await</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">customerRepository</span>.<span class=\"hljs-title function_\">find</span>();\n  } <span class=\"hljs-keyword\">catch</span> (error) {\n    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-title function_\">handleDatabaseError</span>(error);\n  }\n}\n\n <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">getCustomerByPK</span>(<span class=\"hljs-attr\">customerId</span>: <span class=\"hljs-built_in\">number</span>): <span class=\"hljs-title class_\">Promise</span>&lt;<span class=\"hljs-title class_\">Customer</span>&gt; {\n   <span class=\"hljs-keyword\">try</span> {\n     <span class=\"hljs-keyword\">const</span> customer = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">customerRepository</span>.<span class=\"hljs-title function_\">findOne</span>({\n       <span class=\"hljs-attr\">where</span>: { <span class=\"hljs-attr\">customer_id</span>: customerId },\n     });\n     <span class=\"hljs-keyword\">if</span> (!customer) <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AppError</span>(<span class=\"hljs-string\">\"Customer not found.\"</span>, <span class=\"hljs-number\">404</span>);\n     <span class=\"hljs-keyword\">return</span> customer;\n   } <span class=\"hljs-keyword\">catch</span> (error) {\n     <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-title function_\">handleDatabaseError</span>(error);\n   }\n }\n\n <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">updateCustomer</span>(\n   <span class=\"hljs-attr\">customerId</span>: <span class=\"hljs-built_in\">number</span>,\n   <span class=\"hljs-attr\">updates</span>: <span class=\"hljs-title class_\">Partial</span>&lt;<span class=\"hljs-title class_\">Customer</span>&gt;\n ): <span class=\"hljs-title class_\">Promise</span>&lt;<span class=\"hljs-title class_\">Customer</span>&gt; {\n   <span class=\"hljs-keyword\">try</span> {\n     <span class=\"hljs-keyword\">const</span> customer = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">customerRepository</span>.<span class=\"hljs-title function_\">findOne</span>({\n       <span class=\"hljs-attr\">where</span>: { <span class=\"hljs-attr\">customer_id</span>: customerId },\n     });\n\n     <span class=\"hljs-keyword\">if</span> (!customer) <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AppError</span>(<span class=\"hljs-string\">\"Customer not found.\"</span>, <span class=\"hljs-number\">404</span>);\n\n     <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">assign</span>(customer, updates);\n\n     <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">await</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">customerRepository</span>.<span class=\"hljs-title function_\">save</span>(customer);\n   } <span class=\"hljs-keyword\">catch</span> (error) {\n     <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-title function_\">handleDatabaseError</span>(error);\n   }\n }\n\n\n</code></pre>","children":[]}],"payload":{"lines":"50,51"}}],"payload":{"lines":"0,1"}},null)</script>
</body>
</html>
